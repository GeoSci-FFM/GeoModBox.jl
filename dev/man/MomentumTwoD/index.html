<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>2D · GeoModBox.jl</title><meta name="title" content="2D · GeoModBox.jl"/><meta property="og:title" content="2D · GeoModBox.jl"/><meta property="twitter:title" content="2D · GeoModBox.jl"/><meta name="description" content="Documentation for GeoModBox.jl."/><meta property="og:description" content="Documentation for GeoModBox.jl."/><meta property="twitter:description" content="Documentation for GeoModBox.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">GeoModBox.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Governing Equation</span><ul><li><input class="collapse-toggle" id="menuitem-2-1" type="checkbox"/><label class="tocitem" for="menuitem-2-1"><span class="docs-label">Solution</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../GESolution/">General</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-2" type="checkbox"/><label class="tocitem" for="menuitem-2-2"><span class="docs-label">Heat Diffusion Equation</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../DiffMain/">General</a></li><li><a class="tocitem" href="../DiffOneD/">1D</a></li><li><a class="tocitem" href="../DiffTwoD/">2D</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-3" type="checkbox" checked/><label class="tocitem" for="menuitem-2-3"><span class="docs-label">Momentum Equation</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../MomentumMain/">General</a></li><li><a class="tocitem" href="../MomentumOneD/">1D</a></li><li class="is-active"><a class="tocitem" href>2D</a><ul class="internal"><li><a class="tocitem" href="#Discretization"><span>Discretization</span></a></li><li><a class="tocitem" href="#Constant-Viscosity"><span>Constant Viscosity</span></a></li><li><a class="tocitem" href="#Variable-Viscosity"><span>Variable Viscosity</span></a></li><li><a class="tocitem" href="#Continuum-Equation"><span>Continuum Equation</span></a></li><li><a class="tocitem" href="#Solution"><span>Solution</span></a></li></ul></li></ul></li></ul></li><li><a class="tocitem" href="../listoffunctions/">List of functions</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Governing Equation</a></li><li><a class="is-disabled">Momentum Equation</a></li><li class="is-active"><a href>2D</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>2D</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/GeoSci-FFM/GeoModBox.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/GeoSci-FFM/GeoModBox.jl/blob/main/docs/src/man/MomentumTwoD.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Stokes-Equation-(2D)"><a class="docs-heading-anchor" href="#Stokes-Equation-(2D)">Stokes Equation (2D)</a><a id="Stokes-Equation-(2D)-1"></a><a class="docs-heading-anchor-permalink" href="#Stokes-Equation-(2D)" title="Permalink"></a></h1><p>The Stokes equation in two dimensions is defined as: </p><p class="math-container">\[\begin{equation}
0 = -\frac{\partial{P}}{\partial{x_i}} + \frac{\partial}{\partial{x_j}}\tau_{ij} + \rho g_i, 
\end{equation}\]</p><p>where <span>$P$</span> is the total pressure in [ <span>$Pa$</span> ],  <span>$\rho$</span> is the density in [ <span>$kg/m^3$</span> ], <span>$g_i$</span> the gravitational acceleration vector in [ <span>$m/s^2$</span> ], <span>$\frac{\partial}{\partial{x_i}}$</span> the spatial derivative in the direction of <span>$x_i$</span>, and <span>$\tau_{ij}$</span> is the deviatoric stress tensor in [ <span>$Pa$</span> ] and defined as: </p><p class="math-container">\[\begin{equation}
\tau_{ij} = 2\eta \dot{\varepsilon}_{ij}, 
\end{equation}\]</p><p>where <span>$\eta$</span> is the dynamic viscosity in [ <span>$Pa s$</span> ] and <span>$\dot{\varepsilon}_{ij}$</span> is the strain-rate tensor in [ <span>$1/s$</span> ] and given as: </p><p class="math-container">\[\begin{equation}
\dot{\varepsilon}_{ij} = \frac{1}{2} \left( \frac{\partial{v_i}}{\partial{x_j}} + \frac{\partial{v_j}}{\partial{x_i}} \right),
\end{equation}\]</p><p>where <span>$v_i$</span> is the velocity in [ <span>$m/s$</span> ] in the <span>$i$</span>-th direction. </p><p>The stokes equation provides two equations for three unknowns, <span>$v_x$</span>, <span>$v_y$</span>, and <span>$P$</span>. Thus, to solve for the third unknown one needs an additional equation, the <em>mass conservation equation</em>. </p><p>The <em>conservation equation of mass</em> is defined as (assuming an incompressible medium): </p><p class="math-container">\[\begin{equation}
div\left(\overrightharpoon{v} \right) = \left(\frac{\partial{v_i}}{\partial{x_i}}+\frac{\partial{v_j}}{\partial{x_j}}\right) = 0.
\end{equation}\]</p><h2 id="Discretization"><a class="docs-heading-anchor" href="#Discretization">Discretization</a><a id="Discretization-1"></a><a class="docs-heading-anchor-permalink" href="#Discretization" title="Permalink"></a></h2><p>The conservation equations of <em>momentum</em> and <em>mass</em> are solved properly in two dimensions (<span>$x$</span> and <span>$y$</span>) using a staggered finite difference grid, where the horizontal (<em>cyan dashes</em>) and vertical (<em>orange dashes</em>) velocities are defined in between the regular grid points or <em>vertices</em>, and the pressure (<em>red circles</em>) within a finite difference cells or <em>centroids</em> (Figure 1). A staggered grid enables the conservation of the stress between adjacent grid points and care needs to be taken where the corresponding parameters are defined. </p><p><img src="../../assets/MomentumGrid.png" alt="MomentumGrid"/></p><p><strong>Figure 1. Staggered finite difference grid for the momentum equation.</strong> Discretization of the conservation equations of <em>momemtum</em> and <em>mass</em>. The horizontal and vertical velocities require <em>ghost nodes</em> at the <strong>North</strong>, <strong>South</strong>, <strong>East</strong>, and <strong>West</strong> boundary, respectively.</p><hr/><hr/><h2 id="Constant-Viscosity"><a class="docs-heading-anchor" href="#Constant-Viscosity">Constant Viscosity</a><a id="Constant-Viscosity-1"></a><a class="docs-heading-anchor-permalink" href="#Constant-Viscosity" title="Permalink"></a></h2><p>Let&#39;s first assume a special case of the Stokes equation, a <strong>constant viscosity</strong>, which simplifies equation <span>$(1)$</span> to: </p><p class="math-container">\[\begin{equation}
0 = -\frac{\partial{P}}{\partial{x_i}} + 2\eta\frac{\partial^2{v_i}}{\partial{x_i^2}} + \eta\left(\frac{\partial^2{v_i}}{\partial{x_j^2}}+\frac{\partial^2{v_j}}{\partial{x_i^2}}\right) + \rho g_i. 
\end{equation}\]</p><p>Using equation <span>$(4)$</span> and neglecting a horizontal graviational acceleration, equation <span>$(5)$</span> can further be simplified to: </p><p><em><span>$x$</span>-component</em> </p><p class="math-container">\[\begin{equation}
-\frac{\partial{P}}{\partial{x}} + \eta\frac{\partial^2{v_x}}{\partial{x^2}} + \eta\frac{\partial^2{v_x}}{\partial{y^2}} = 0, 
\end{equation}\]</p><p><em><span>$y$</span>-component</em></p><p class="math-container">\[\begin{equation}
-\frac{\partial{P}}{\partial{y}} + \eta\frac{\partial^2{v_y}}{\partial{y^2}} + \eta\frac{\partial^2{v_y}}{\partial{x^2}} = - \rho g_y. 
\end{equation}\]</p><p>For each equation, one can define a so-called numerical stencil which highlights the position of the required parameters with respect to a central point <span>$(i,j)$</span>, where <span>$i$</span> and <span>$j$</span> are the indices in the horizontal and vertical direction, respectively, for each parameter dimension. The central point also corresponds to the number of the equation in the linear system of equations. </p><h3 id="Stencil"><a class="docs-heading-anchor" href="#Stencil">Stencil</a><a id="Stencil-1"></a><a class="docs-heading-anchor-permalink" href="#Stencil" title="Permalink"></a></h3><p>The stencils for the <em>momentum equation</em> assuming a constant viscosity show the points (parameter) required to solve the equations for each component of the <em>momentum equation</em> using the finite difference approach (Figure 2). </p><p><img src="../../assets/Stencil_const_eta.png" alt="StencilConstEta"/></p><p><strong>Figure 2. Numerical stencils for a constant viscosity.</strong> a) <em><span>$x$</span>-component</em>. b) <em><span>$y$</span>-component</em>.</p><p>Using the finite difference approximations for the partial derivatives, equations <span>$(6)$</span> and <span>$(7)$</span> are defined as: </p><p><em><span>$x$</span>-component</em></p><p class="math-container">\[\begin{equation}\begin{gather*}
&amp; -\frac{P_{i,j}-P_{i-1,j}}{\Delta{x}} + \\ &amp; \eta\frac{v_{x,(i-1,j)}-2v_{x,(i,j)}+v_{x,(i+1,j)}}{\Delta{x^2}} + \\ &amp;  \eta\frac{v_{x,(i,j-1)}-2v_{x,(i,j)}+v_{x,(i,j+1)}}{\Delta{y^2}} = 0.
\end{gather*}\end{equation}\]</p><p>Rearranging and sorting the variables results in: </p><p class="math-container">\[\begin{equation}\begin{gather*}
&amp; P_CP_{i,j} + P_WP_{i-1,j} + \\ &amp; Sv_{x,(i,j-1)} +  Wv_{x,(i-1,j)} + \\ &amp; Cv_{x,(i,j)} + \\ &amp; E v_{x,(i+1,j)} + N v_{x,(i,j+1)} = 0, 
\end{gather*}\end{equation}\]</p><p>where </p><p class="math-container">\[\begin{equation}
\begin{split}
P_C &amp; = -\frac{1}{\Delta{x}},  \\
P_W &amp; = \frac{1}{\Delta{x}}, \\
S &amp; = \frac{\eta}{\Delta{y^2}}, \\
W &amp; = \frac{\eta}{\Delta{x^2}}, \\
C &amp; = -2\eta\left(\frac{1}{\Delta{x^2}}+\frac{1}{\Delta{y^2}}\right), \\
E &amp; = \frac{\eta}{\Delta{x^2}}, \\
N &amp; = \frac{\eta}{\Delta{y^2}}. \\
\end{split}
\end{equation}\]</p><p><em><span>$y$</span>-component</em></p><p class="math-container">\[\begin{equation}\begin{gather*}
&amp; -\frac{P_{i,j}-P_{i,j-1}}{\Delta{y}} + \\ &amp; \eta\frac{v_{y,(i,j-1)}-2v_{y,(i,j)}+v_{x,(i,j+1)}}{\Delta{y^2}} + \\ &amp; \eta\frac{v_{y,(i-1,j)}-2v_{y,(i,j)}+v_{y,(i+1,j)}}{\Delta{x^2}} = \\ &amp; -\frac{\rho_{i,j}+\rho_{i+1,j}}{2} g_y.
\end{gather*}\end{equation}\]</p><p>Rearranging and sorting the variables results in: </p><p class="math-container">\[\begin{equation}\begin{gather*}
&amp; P_SP_{i,j-1} + P_CP_{i,j} + \\ &amp; Sv_{y,(i,j-1)} + Wv_{y,(i-1,j)} + \\ &amp; Cv_{y,(i,j)} + \\ &amp; E v_{y,(i+1,j)} + N v_{y,(i,j+1)} = \\ &amp; -\frac{\rho_{i,j}+\rho_{i+1,j}}{2} g_y, 
\end{gather*}\end{equation}\]</p><p>where </p><p class="math-container">\[\begin{equation}
\begin{split}
P_S &amp; = \frac{1}{\Delta{y}},  \\
P_C &amp; = -\frac{1}{\Delta{y}}, \\
S &amp; = \frac{\eta}{\Delta{y^2}}, \\
W &amp; = \frac{\eta}{\Delta{x^2}}, \\
C &amp; = -2\eta\left(\frac{1}{\Delta{x^2}}+\frac{1}{\Delta{y^2}}\right), \\
E &amp; = \frac{\eta}{\Delta{x^2}}, \\
N &amp; = \frac{\eta}{\Delta{y^2}}. \\
\end{split}
\end{equation}\]</p><h3 id="Boundary-Conditions"><a class="docs-heading-anchor" href="#Boundary-Conditions">Boundary Conditions</a><a id="Boundary-Conditions-1"></a><a class="docs-heading-anchor-permalink" href="#Boundary-Conditions" title="Permalink"></a></h3><p>The most common boundary conditions for the <em>momentum equation</em> are a combination of <em>Dirichlet</em> and <em>Neumann</em> velocity boundary conditions: <strong>free slip</strong> and <strong>no slip</strong> boundary condition. </p><hr/><p><strong>Free slip</strong> </p><p><em>Free slip</em> boundary conditions allow the fluid to move along the boundary assuming <strong>no shear stress</strong> and <strong>no orthogonal velocity</strong> along the boundary. That is for the lateral boundaries <strong>(East, West)</strong> the conditions are: </p><p class="math-container">\[\begin{equation}
\begin{split}
v_x = 0, \\
\frac{\partial{v_{y}}}{\partial{x}}=0,
\end{split}
\end{equation}\]</p><p>and for the horizontal bounaries <strong>(North, South)</strong> the conditions are: </p><p class="math-container">\[\begin{equation}
\begin{split}
v_y = 0, \\
\frac{\partial{v_{x}}}{\partial{y}}=0.
\end{split}
\end{equation}\]</p><p>Solving the system of equations using a direct solution, one needs to modify the coefficients of the required points adjacent to the boundaries using the velocities defined at the <em>ghost nodes</em> <strong>and</strong> the right-hand side. </p><p><em><span>$x$</span>-component</em></p><p>For <em>free slip</em> boundary conditions one needs to define the horizontal velocity <span>$v_x$</span> for the <em>ghost nodes</em> at the upper (<strong>North</strong>) and lower (<strong>South</strong>) boundary which are defined as (see equation <span>$(15)$</span> ): </p><p><em>South</em></p><p class="math-container">\[\begin{equation}
v_{x,(i,GS)} = v_{x,(i,1)},
\end{equation}\]</p><p><em>North</em></p><p class="math-container">\[\begin{equation}
v_{x,(i,GN)} = v_{x,(i,ncy)}.
\end{equation}\]</p><p>Along the lateral boundaries (<strong>East</strong>, <strong>West</strong>) we can simply set the velocity <span>$v_x$</span> to zero (see equation <span>$(14)$</span> ).</p><p><em><span>$y$</span>-component</em></p><p>For the vertical velocity <span>$v_y$</span> one needs to define the velocity at the <em>ghost nodes</em> for the left (<strong>West</strong>) and right (<strong>East</strong>) boundary as (see equation <span>$(14)$</span> ): </p><p><em>West</em></p><p class="math-container">\[\begin{equation}
v_{y,(GW,j)} = v_{y,(1,j)},
\end{equation}\]</p><p><em>East</em></p><p class="math-container">\[\begin{equation}
v_{y,(GE,j)} = v_{y,(ncx,j)}.
\end{equation}\]</p><p>Along the horizontal boundaries (<strong>North</strong>, <strong>South</strong>), we can simply set the velocity <span>$v_y$</span> to zero (see equation <span>$(15)$</span> ). </p><p>Using the equations <span>$(16)$</span> - <span>$(19)$</span> the coefficients of the equations adjacent to the corresponding boundaries changes (the right-hand side actually does not change for <em>free slip</em> boundary conditions) to: </p><p><em><span>$x$</span>-component</em> </p><p><em>South</em></p><p class="math-container">\[\begin{equation}\begin{gather*}
&amp; P_WP_{i-1,j}+P_CP_{i,j}+ \\ &amp; Wv_{x,(i-1,j)}+ \\ &amp; Cv_{x,(i,j)}+ \\ &amp; Ev_{x,(i+1,j)}+Nv_{x,(i,j+1)} = 0,
\end{gather*}\end{equation}\]</p><p>where </p><p class="math-container">\[\begin{equation}C = -\frac{2\eta}{\Delta{x^2}}-\frac{\eta}{\Delta{y^2}}.\end{equation}\]</p><p><em>North</em></p><p class="math-container">\[\begin{equation}\begin{gather*}
&amp; P_WP_{i-1,j}+P_CP_{i,j}+ \\ &amp; Sv_{x,(i,j-1)}+ Wv_{x,(i-1,j)}+ \\ &amp; Cv_{x,(i,j)}+ \\ &amp; Ev_{x,(i+1,j)} = 0,
\end{gather*}\end{equation}\]</p><p>where </p><p class="math-container">\[\begin{equation}C = -\frac{2\eta}{\Delta{x^2}}-\frac{\eta}{\Delta{y^2}}.\end{equation}\]</p><p>Along the lateral boundaries (<strong>East</strong>, <strong>West</strong>), <span>$C=1$</span> and the remaining coefficients are equal to zero.</p><p><em><span>$y$</span>-component</em> </p><p><em>West</em></p><p class="math-container">\[\begin{equation}\begin{gather*}
&amp; P_SP_{i,j-1}+P_CP_{i,j}+ \\ &amp; Sv_{y,(i,j-1)}+ \\ &amp; Cv_{y,(i,j)}+ \\ &amp; Ev_{y,(i+1,j)}+ Nv_{y,(i,j+1)} = \\ &amp; -\frac{\rho_{i,j}+\rho_{i+1,j}}{2} g_y,
\end{gather*}\end{equation}\]</p><p>where </p><p class="math-container">\[\begin{equation}C = -\frac{\eta}{\Delta{x^2}}-\frac{2\eta}{\Delta{y^2}}.\end{equation}\]</p><p><em>East</em></p><p class="math-container">\[\begin{equation}\begin{gather*}
&amp; P_SP_{i,j-1}+P_CP_{i,j}+ \\ &amp; Sv_{y,(i,j-1)}+ Wv_{y,(i-1,j)}+ \\ &amp; Cv_{y,(i,j)}+ \\ &amp; Nv_{y,(i,j+1)} = \\ &amp; -\frac{\rho_{i,j}+\rho_{i+1,j}}{2} g_y,
\end{gather*}\end{equation}\]</p><p>where </p><p class="math-container">\[\begin{equation}C = -\frac{\eta}{\Delta{x^2}}-\frac{2\eta}{\Delta{y^2}}.\end{equation}\]</p><p>Along the horizontal boundaries (<strong>North</strong>, <strong>South</strong>), <span>$C=1$</span> and the remaining coefficients are equal to zero.</p><hr/><p><strong>No slip</strong> </p><p><em>No slip</em> boundary conditions fix the fluid along the boundary and set the horizontal and vertical velocity equal to zero. </p><p>That is, for all boundaries (<strong>East</strong>, <strong>West</strong>, <strong>South</strong>, <strong>North</strong>) the conditions are: </p><p class="math-container">\[\begin{equation}
\begin{split}
v_x = 0, \\
v_y = 0.
\end{split}
\end{equation}\]</p><p><em><span>$x$</span>-component</em></p><p>One needs the velocity at the <em>ghost nodes</em> for the horizontal velocity <span>$v_x$</span> at the lower (<strong>South</strong>) and upper (<strong>North</strong>) boundary which are defined as: </p><p><em>South</em></p><p class="math-container">\[\begin{equation}
v_{x,(i,GS)} = 2V_{BC,S} - v_{x,(i,1)},
\end{equation}\]</p><p>where <span>$V_{BC,S}$</span> is the velocity along the boundary (here 0).</p><p><em>North</em></p><p class="math-container">\[\begin{equation}
v_{x,(i,GN)} = 2V_{BC,N} - v_{x,(i,ncy)},
\end{equation}\]</p><p>where <span>$V_{BC,N}$</span> is the velocity along the boundary (here 0). </p><p>Along the lateral boundaries (<strong>East</strong>, <strong>West</strong>) we can simply set the horizontal velocity <span>$v_x$</span> to zero (as in the <em>free slip</em> case). </p><p><em><span>$y$</span>-component</em> </p><p>For the vertical velocity <span>$v_y$</span> one needs to define the velocity at the <em>ghost nodes</em> for the left (<strong>West</strong>) and right (<strong>East</strong>) boundary as: </p><p><em>West</em></p><p class="math-container">\[\begin{equation}
v_{y,(GW,j)} = 2V_{BC,W} - v_{y,(1,j)},
\end{equation}\]</p><p>where <span>$V_{BC,W}$</span> is the velocity along the boundary (here 0).</p><p><em>East</em></p><p class="math-container">\[\begin{equation}
v_{y,(GE,j)} = 2V_{BC,E} - v_{y,(ncx,j)},
\end{equation}\]</p><p>where <span>$V_{BC,E}$</span> is the velocity along the boundary (here 0). </p><p>Along the horizontal boundaries (<strong>North</strong>, <strong>South</strong>), we can simply set the vertical velocity <span>$v_y$</span> to zero (as in the <em>free slip</em> case). </p><p>Using the equations <span>$(29)$</span> - <span>$(32)$</span> the coefficients of the equations adjacent to the corresponding boundaries and the right-hand side changes to: </p><p><em><span>$x$</span>-component</em> </p><p><em>South</em></p><p class="math-container">\[\begin{equation}\begin{gather*}
&amp; P_WP_{i-1,j}+P_CP_{i,j}+ \\ &amp; Wv_{x,(i-1,j)}+ \\ &amp; Cv_{x,(i,j)}+ \\ &amp; Ev_{x,(i+1,j)}+Nv_{x,(i,j+1)} = \\ &amp; -2\frac{\eta}{\Delta{y^2}}V_{BC,S},
\end{gather*}\end{equation}\]</p><p>where </p><p class="math-container">\[\begin{equation}C = -\frac{2\eta}{\Delta{x^2}}-\frac{3\eta}{\Delta{y^2}}.\end{equation}\]</p><p><em>North</em></p><p class="math-container">\[\begin{equation}\begin{gather*}
&amp; P_WP_{i-1,j}+P_CP_{i,j}+ \\ &amp; Sv_{x,(i,j-1)}+Wv_{x,(i-1,j)}+ \\ &amp; Cv_{x,(i,j)}+ \\ &amp; Ev_{x,(i+1,j)} = \\ &amp; -2\frac{\eta}{\Delta{y^2}}V_{BC,N},
\end{gather*}\end{equation}\]</p><p>where </p><p class="math-container">\[\begin{equation}C = -\frac{2\eta}{\Delta{x^2}}-\frac{3\eta}{\Delta{y^2}}.\end{equation}\]</p><p>Along the lateral boundaries (<strong>East</strong>, <strong>West</strong>), <span>$C=1$</span> and the remaining coefficients and the right-hand side are equal to zero.</p><p><em><span>$y$</span>-component</em> </p><p><em>West</em></p><p class="math-container">\[\begin{equation}\begin{gather*}
&amp; P_SP_{i,j-1}+P_CP_{i,j}+ \\ &amp; Sv_{y,(i,j-1)}+ \\ &amp; Cv_{y,(i,j)}+ \\ &amp; Ev_{y,(i+1,j)}+Nv_{y,(i,j+1)} = \\ &amp; -\frac{\rho_{i,j} + \rho_{i+1,j}}{2} g_y - 2\frac{\eta}{\Delta{x^2}}V_{BC,W},
\end{gather*}\end{equation}\]</p><p>where </p><p class="math-container">\[\begin{equation}C = -\frac{3\eta}{\Delta{x^2}}-\frac{2\eta}{\Delta{y^2}}.\end{equation}\]</p><p><em>East</em></p><p class="math-container">\[\begin{equation}\begin{gather*}
&amp; P_SP_{i,j-1}+P_CP_{i,j}+ \\ &amp; Sv_{y,(i,j-1)}+Wv_{y,(i-1,j)}+ \\ &amp; Cv_{y,(i,j)}+ \\ &amp; Nv_{y,(i,j+1)} = \\ &amp; -\frac{\rho_{i,j} + \rho_{i+1,j}}{2} g_y - 2\frac{\eta}{\Delta{x^2}}V_{BC,W},
\end{gather*}\end{equation}\]</p><p>where </p><p class="math-container">\[\begin{equation}C = -\frac{3\eta}{\Delta{x^2}}-\frac{2\eta}{\Delta{y^2}}.\end{equation}\]</p><p>Along the horizontal boundaries (<strong>East</strong>, <strong>West</strong>), <span>$C=1$</span> and the remaining coefficients and the right-hand side are equal to zero.</p><p>For more details on how this is implemented, please see the <a href="https://github.com/GeoSci-FFM/GeoModBox.jl/blob/main/src/MomentumEquation/2Dsolvers.jl">source code</a>.</p><hr/><hr/><h2 id="Variable-Viscosity"><a class="docs-heading-anchor" href="#Variable-Viscosity">Variable Viscosity</a><a id="Variable-Viscosity-1"></a><a class="docs-heading-anchor-permalink" href="#Variable-Viscosity" title="Permalink"></a></h2><p>In case of a variable viscosity, equation <span>$(1)$</span> is given in the form of the unknowns as: </p><p><em><span>$x$</span>-component</em></p><p class="math-container">\[\begin{equation}
-\frac{\partial{P}}{\partial{x}} + \frac{\partial{}}{\partial{x}}\left(2\eta_c\frac{\partial{v_x}}{\partial{x}}\right)+\frac{\partial{}}{\partial{y}}\left( \eta_v\left(\frac{\partial{v_x}}{\partial{y}} + \frac{\partial{v_y}}{\partial{x}}\right)\right) = 0,
\end{equation}\]</p><p>and</p><p><em><span>$y$</span>-component</em></p><p class="math-container">\[\begin{equation}
-\frac{\partial{P}}{\partial{y}} + \frac{\partial{}}{\partial{y}}\left(2\eta_c\frac{\partial{v_y}}{\partial{y}}\right)+\frac{\partial{}}{\partial{x}}\left( \eta_v\left(\frac{\partial{v_y}}{\partial{x}} + \frac{\partial{v_x}}{\partial{y}}\right)\right) = -\frac{\rho_{i,j}+\rho_{i+1,j}}{2}g_y,
\end{equation}\]</p><p>where <span>$\eta_c$</span> is the viscosity at the <em>centroids</em> and <span>$\eta_v$</span> the viscosity at the <em>vertices</em>. </p><h3 id="Stencil-2"><a class="docs-heading-anchor" href="#Stencil-2">Stencil</a><a class="docs-heading-anchor-permalink" href="#Stencil-2" title="Permalink"></a></h3><p>The stencils for the <em>momentum equation</em> assuming a variable viscosity show the points (parameter) required to solve the equations for each component of the <em>momentum equation</em> using the finite difference approach (Figure 3).</p><p><img src="../../assets/Stencil_vary_eta.png" alt="Stencil_vary_eta"/></p><p><strong>Figure 3.</strong> <strong>Numerical stencils for a variable viscosity.</strong> a) <em><span>$x$</span>-component</em>, b) <em><span>$y$</span>-component</em>.  </p><p><strong>Note</strong>: In the following, the index <span>$(i,j)$</span> for each parameter <span>$\left(v_x, v_y, P, \eta_c,\ \textrm{and}\  \eta_v\right)$</span> is always referring to the central point of the stencil of each parameter grid (see Figure 3). </p><p>Using the finite difference approximations for the partial derivatives, equations <span>$(41)$</span> and <span>$(42)$</span> are defined as: </p><p><em><span>$x$</span>-component</em></p><p class="math-container">\[\begin{equation}
-\frac{P_{i,j}-P_{i-1,j}}{\Delta{x}}+\frac{\tau_{xx,(i,j)} -\tau_{xx,(i-1,j)}}{\Delta{x}} + \frac{\tau_{xy,(i,j+1)}-\tau_{xy,(i,j)}}{\Delta{y}} = 0,
\end{equation}\]</p><p>or</p><p class="math-container">\[\begin{equation}\begin{gather*}
&amp; -\frac{P_{i,j}-P_{i-1,j}}{\Delta{x}}+\\ &amp; \frac{2\eta_{c,(i,j)}\frac{\partial{v_x}}{\partial{x}}\vert_{i,j} -2\eta_{c,(i-1,j)}\frac{\partial{v_x}}{\partial{x}}\vert_{i-1,j}}{\Delta{x}} + \\ &amp; \frac{\eta_{v,(i,j+1)}\left(\frac{\partial{v_x}}{\partial{y}}\vert_{i,j+1}+\frac{\partial{v_y}}{\partial{x}}\vert_{i,j+1}\right)-\eta_{v,(i,j)}\left(\frac{\partial{v_x}}{\partial{y}}\vert_{i,j}+\frac{\partial{v_y}}{\partial{x}}\vert_{i,j}\right)}{\Delta{y}} = 0,
\end{gather*}\end{equation}\]</p><p>and in the form of the unknowns: </p><p class="math-container">\[\begin{equation}\begin{gather*}
&amp; -\frac{P_{i,j}-P_{i-1,j}}{\Delta{x}}+ \\ &amp; \frac{2\eta_{c,(i,j)}}{\Delta{x}}\left(\frac{v_{x,(i+1,j)}-v_{x,(i,j)}}{\Delta{x}}\right) - \\ &amp; \frac{2\eta_{c,(i-1,j)}}{\Delta{x}}\left(\frac{v_{x,(i,j)}-v_{x,(i-1,j)}}{\Delta{x}}\right)+ \\ &amp; \frac{\eta_{v,(i,j+1)}}{\Delta{y}}\left(\frac{v_{x,(i,j+1)}-v_{x,(i,j)}}{\Delta{y}} + \frac{v_{y,(i,j+1)}-v_{y,(i-1,j+1)}}{\Delta{x}}\right) - \\ &amp;  \frac{\eta_{v,(i,j)}}{\Delta{y}}\left(\frac{v_{x,(i,j)}-v_{x,(i,j-1)}}{\Delta{y}} + \frac{v_{y,(i,j)}-v_{y,(i-1,j)}}{\Delta{x}}\right) = 0.
\end{gather*}\end{equation}\]</p><p>Rearranging and sorting the variables results in: </p><p class="math-container">\[\begin{equation}\begin{gather*}
&amp; P_WP_{i-1,j}+P_CP_{i,j} + \\ &amp; Sv_{x,(i,j-1)}+SWv_{y,(i-1,j)}+SEv_{y,(i,j)}+Wv_{x,(i-1,j)}+ \\ &amp; Cv_{x,(i,j)} + \\ &amp; Ev_{x,(i+1,j)} + NWv_{y,(i-1,j+1)} + NEv_{y,(i,j+1)} + Nv_{x,(i,j+1)} = \\ &amp; 0, 
\end{gather*}\end{equation}\]</p><p>where</p><p class="math-container">\[\begin{equation}\begin{split}
P_W &amp; = \frac{1}{\Delta{x}} ,\\
P_C &amp; = -\frac{1}{\Delta{x}}, \\
S &amp; = \frac{\eta_{v,(i,j)}}{\Delta{y^2}},\\
SW &amp; = \frac{\eta_{v,(i,j)}}{\Delta{x}\Delta{y}},\\
SE &amp; = -\frac{\eta_{v,(i,j)}}{\Delta{x}\Delta{y}},\\
W &amp; = \frac{2\eta_{c,(i-1,j)}}{\Delta{x^2}},\\
C &amp; = -\frac{2}{\Delta{x^2}}\left(\eta_{c,(i,j)}+\eta_{c,(i-1,j)}\right)-\frac{1}{\Delta{y^2}}\left(\eta_{v,(i,j+1)} + \eta_{v,(i,j)} \right), \\
E &amp; = \frac{2\eta_{c,(i,j)}}{\Delta{x^2}},\\
NW &amp; = -\frac{\eta_{v,(i,j+1)}}{\Delta{x}\Delta{y}},\\
NE &amp; = \frac{\eta_{v,(i,j+1)}}{\Delta{x}\Delta{y}},\\
N &amp; = \frac{\eta_{v,(i,j+1)}}{\Delta{y^2}}.\\
\end{split}\end{equation}\]</p><p><em><span>$y$</span>-component</em></p><p class="math-container">\[\begin{equation}
-\frac{P_{i,j}-P_{i,j-1}}{\Delta{y}}+\frac{\tau_{yy,(i,j)} - \tau_{yy,(i,j-1)}}{\Delta{y}} + \frac{\tau_{yx,(i+1,j)}-\tau_{yx,(i,j)}}{\Delta{x}} = -\frac{\rho_{i,j}+\rho_{i+1,j}}{2} g_y,
\end{equation}\]</p><p>or </p><p class="math-container">\[\begin{equation}\begin{gather*}
&amp; -\frac{P_{i,j}-P_{i,j-1}}{\Delta{y}}+ \\ &amp; \frac{2\eta_{c,(i,j)}\frac{\partial{v_y}}{\partial{y}}\vert_{i,j} -2\eta_{c,(i,j-1)}\frac{\partial{v_y}}{\partial{y}}\vert_{i,j-1}}{\Delta{y}} + \\ &amp; \frac{\eta_{v,(i+1,j)}\left(\frac{\partial{v_y}}{\partial{x}}\vert_{i+1,j}+\frac{\partial{v_x}}{\partial{y}}\vert_{i+1,j}\right)-\eta_{v,(i,j)}\left(\frac{\partial{v_y}}{\partial{x}}\vert_{i,j}+\frac{\partial{v_x}}{\partial{y}}\vert_{i,j}\right)}{\Delta{x}} = \\ &amp; -\frac{\rho_{i,j}+\rho_{i+1,j}}{2} g_y,
\end{gather*}\end{equation}\]</p><p>and in the form of the unknowns: </p><p class="math-container">\[\begin{equation}\begin{gather*}
&amp; -\frac{P_{i,j}-P_{i,j-1}}{\Delta{y}}+ \\ &amp; \frac{2\eta_{c,(i,j)}}{\Delta{y}}\left(\frac{v_{y,(i,j+1)}-v_{y,(i,j)}}{\Delta{y}}\right) - \\ &amp; \frac{2\eta_{c,(i,j-1)}}{\Delta{y}}\left(\frac{v_{y,(i,j)}-v_{y,(i,j-1)}}{\Delta{y}}\right)+ \\ &amp; \frac{\eta_{v,(i+1,j)}}{\Delta{x}}\left(\frac{v_{y,(i+1,j)}-v_{y,(i,j)}}{\Delta{x}} + \frac{v_{x,(i+1,j)}-v_{x,(i+1,j-1)}}{\Delta{y}}\right) - \\ &amp; \frac{\eta_{v,(i,j)}}{\Delta{x}}\left(\frac{v_{y,(i,j)}-v_{y,(i-1,j)}}{\Delta{x}} + \frac{v_{x,(i,j)}-v_{x,(i,j-1)}}{\Delta{y}}\right) = \\ &amp; -\frac{\rho_{i,j}+\rho_{i+1,j}}{2} g_y.
\end{gather*}\end{equation}\]</p><p>Rearranging and sorting the variables results in: </p><p class="math-container">\[\begin{equation}\begin{gather*}
&amp; P_CP_{i,j}+P_SP_{i,j-1} + \\ &amp; Sv_{y,(i,j-1)}+SWv_{x,(i,j-1)}+SEv_{x,(i+1,j-1)}+Wv_{y,(i-1,j)}+ \\ &amp; Cv_{y,(i,j)} + \\ &amp; Ev_{y,(i+1,j)} + NWv_{x,(i,j)} + NEv_{x,(i+1,j)} + Nv_{y,(i,j+1)} = \\ &amp; -\frac{\rho_{i,j}+\rho_{i+1,j}}{2} g_y, 
\end{gather*}\end{equation}\]</p><p>where</p><p class="math-container">\[\begin{equation}\begin{split}
P_S &amp; = \frac{1}{\Delta{y}}, \\
P_C &amp; = -\frac{1}{\Delta{y}}, \\
S &amp; = \frac{2\eta_{c,(i,j-1)}}{\Delta{y^2}},\\
SW &amp; = \frac{\eta_{v,(i,j)}}{\Delta{x}\Delta{y}},\\
SE &amp; = -\frac{\eta_{v,(i+1,j)}}{\Delta{x}\Delta{y}},\\
W &amp; = \frac{\eta_{v,(i,j)}}{\Delta{x^2}},\\
C &amp; = -\frac{2}{\Delta{y^2}}\left(\eta_{c,(i,j)}+\eta_{c,(i,j-1)}\right)-\frac{1}{\Delta{x^2}}\left(\eta_{v,(i+1,j)} + \eta_{v,(i,j)} \right), \\
E &amp; = \frac{\eta_{v,(i+1,j)}}{\Delta{x^2}},\\
NW &amp; = -\frac{\eta_{v,(i,j)}}{\Delta{x}\Delta{y}},\\
NE &amp; = \frac{\eta_{v,(i+1,j)}}{\Delta{x}\Delta{y}},\\
N &amp; = \frac{2\eta_{c,(i,j)}}{\Delta{y^2}}.\\
\end{split}\end{equation}\]</p><h3 id="Boundary-Conditions-2"><a class="docs-heading-anchor" href="#Boundary-Conditions-2">Boundary Conditions</a><a class="docs-heading-anchor-permalink" href="#Boundary-Conditions-2" title="Permalink"></a></h3><p>The velocities for the <em>ghost nodes</em> to define the different velocity boundary conditions are the same as described for the constant viscosity case.</p><hr/><p><strong>Free Slip</strong></p><p>Using the equations <span>$(16)$</span> - <span>$(19)$</span> the coefficients of the equations adjacent to the corresponding boundaries changes (the right-hand side actually does not change for <em>free slip</em> boundary conditions) to: </p><p><em><span>$x$</span>-component</em> </p><p><em>South</em></p><p class="math-container">\[\begin{equation}\begin{gather*}
&amp; P_WP_{i-1,j}+P_CP_{i,j} +\\ &amp; SWv_{y,(i-1,j)}+SEv_{y,(i,j)}+Wv_{x,(i-1,j)}+\\ &amp; Cv_{x,(i,j)}+\\ &amp; Ev_{x,(i+1,j)}+NWv_{y,(i-1,j+1)}+NEv_{y,(i,j+1)}+Nv_{x,(i,j+1)} = 0,
\end{gather*}\end{equation}\]</p><p>where </p><p class="math-container">\[\begin{equation}C = -\frac{2}{\Delta{x^2}} \left( \eta_{c,(i,j)} + \eta_{c,(i-1,j)} \right) - \frac{\eta_{v,(i,j+1)}}{\Delta{y^2}}.\end{equation}\]</p><p><em>North</em></p><p class="math-container">\[\begin{equation}\begin{gather*}
&amp; P_WP_{i-1,j}+P_CP_{i,j}+\\ &amp; Sv_{x,(i,j-1)}+SWv_{y,(i-1,j)}+SEv_{y,(i,j)}+Wv_{x,(i-1,j)}+\\ &amp; Cv_{x,(i,j)}+ \\ &amp; Ev_{x,(i+1,j)}+NWv_{y,(i-1,j+1)}+NEv_{y,(i,j+1)} = 0,
\end{gather*}\end{equation}\]</p><p>where </p><p class="math-container">\[\begin{equation}C = -\frac{2}{\Delta{x^2}}\left(\eta_{c,(i,j)}+\eta_{c,(i-1,j)}\right)-\frac{\eta_{v,(i,j)}}{\Delta{y^2}}.\end{equation}\]</p><p>Along the lateral boundaries (<strong>East</strong>, <strong>West</strong>), <span>$C=1$</span> and the remaining coefficients are equal to zero.</p><p><em><span>$y$</span>-component</em> </p><p><em>West</em> </p><p class="math-container">\[\begin{equation}\begin{gather*}
&amp; P_CP_{i,j}+P_SP_{i,j-1} + \\ &amp; Sv_{y,(i,j-1)} + SWv_{x,(i,j-1)} + SEv_{x,(i+1,j-1)} + \\ &amp; Cv_{y,(i,j)} + \\ &amp; Ev_{y,(i+1,j)} + NWv_{x,(i,j)} + NEv_{x,(i+1,j)} + Nv_{y,(i,j+1)} = \\ &amp; -\frac{\rho_{i,j}+\rho_{i+1,j}}{2} g_y, 
\end{gather*}\end{equation}\]</p><p>where </p><p class="math-container">\[\begin{equation}C = -\frac{2}{\Delta{y^2}}\left(\eta_{c,(i,j)}+\eta_{c,(i,j-1)}\right)-\frac{\eta_{v,(i+1,j)}}{\Delta{x^2}}.\end{equation}\]</p><p><em>East</em> </p><p class="math-container">\[\begin{equation}\begin{gather*}
&amp; P_CP_{i,j} + P_SP_{i,j-1} + \\ &amp; Sv_{y,(i,j-1)} + SWv_{x,(i,j-1)} + SEv_{x,(i+1,j-1)} + Wv_{y,(i-1,j)} + \\ &amp; Cv_{y,(i,j)} + \\ &amp; NWv_{x,(i,j)} + NEv_{x,(i+1,j)} + Nv_{y,(i,j+1)} = \\ &amp; -\frac{\rho_{i,j}+\rho_{i+1,j}}{2} g_y, 
\end{gather*}\end{equation}\]</p><p>where </p><p class="math-container">\[\begin{equation}C = -\frac{2}{\Delta{y^2}}\left(\eta_{c,(i,j)}+\eta_{c,(i,j-1)}\right)-\frac{\eta_{v,(i,j)}}{\Delta{x^2}}.\end{equation}\]</p><p>Along the horizontal boundaries (<strong>North</strong>, <strong>South</strong>), <span>$C=1$</span> and the remaining coefficients are equal to zero.</p><hr/><p><strong>No Slip</strong></p><p>Using the equations <span>$(29)$</span> - <span>$(32)$</span> the coefficients of the equations adjacent to the corresponding boundaries and the right-hand side changes to: </p><p><em><span>$x$</span>-component</em> </p><p><em>South</em></p><p class="math-container">\[\begin{equation}\begin{gather*}
&amp; P_WP_{i-1,j}+P_CP_{i,j}+ \\ &amp; SWv_{y,(i-1,j)}+SEv_{y,(i,j)}+Wv_{x,(i-1,j)}+ \\ &amp; Cv_{x,(i,j)}+ \\ &amp; Ev_{x,(i+1,j)}+NWv_{y,(i-1,j+1)}+NEv_{y,(i,j+1)}+Nv_{x,(i,j+1)} = \\ &amp; -2\frac{\eta_{v,(i,j)}}{\Delta{y^2}}V_{BC,S},
\end{gather*}\end{equation}\]</p><p>where </p><p class="math-container">\[\begin{equation}C = -\frac{2}{\Delta{x^2}}\left(\eta_{c,(i,j)}+\eta_{c,(i-1,j)}\right)-\frac{\eta_{v,(i,j+1)}}{\Delta{y^2}}-\frac{2\eta_{v,(i,j)}}{\Delta{y^2}}.\end{equation}\]</p><p><em>North</em> </p><p class="math-container">\[\begin{equation}\begin{gather*}
&amp; P_WP_{i-1,j}+P_CP_{i,j}+ \\ &amp; Sv_{x,(i,j-1)}+SWv_{y,(i-1,j)}+SEv_{y,(i,j)}+Wv_{x,(i-1,j)}+ \\ &amp; Cv_{x,(i,j)}+ \\ &amp; Ev_{x,(i+1,j)}+NWv_{y,(i-1,j+1)}+NEv_{y,(i,j+1)} = \\ &amp; -2\frac{\eta_{v,(i,j+1)}}{\Delta{y^2}}V_{BC,N},
\end{gather*}\end{equation}\]</p><p>where </p><p class="math-container">\[\begin{equation}C = -\frac{2}{\Delta{x^2}}\left(\eta_{c,(i,j)}+\eta_{c,(i-1,j)}\right)-\frac{2\eta_{v,(i,j+1)}}{\Delta{y^2}}-\frac{\eta_{v,(i,j)}}{\Delta{y^2}}.\end{equation}\]</p><p>Along the lateral boundaries (<strong>East</strong>, <strong>West</strong>), <span>$C=1$</span> and the remaining coefficients and the right-hand side are equal to zero.</p><p><em><span>$y$</span>-component</em> </p><p><em>West</em> </p><p class="math-container">\[\begin{equation}\begin{gather*}
&amp; P_CP_{i,j} + P_SP_{i,j-1} + \\ &amp; Sv_{y,(i,j-1)} + SWv_{x,(i,j-1)} + SEv_{x,(i+1,j-1)} + \\ &amp; Cv_{y,(i,j)} + \\ &amp; Ev_{y,(i+1,j)} + NWv_{x,(i,j)} + NEv_{x,(i+1,j)} + Nv_{y,(i,j+1)} = \\ &amp; -\frac{\rho_{i,j}+\rho_{i+1,j}}{2} g_y - 2\frac{\eta_{v,(i,j)}}{\Delta{x^2}}V_{BC,W}, 
\end{gather*}\end{equation}\]</p><p>where </p><p class="math-container">\[\begin{equation}C = -\frac{2}{\Delta{y^2}}\left(\eta_{c,(i,j)}+\eta_{c,(i,j-1)}\right)-\frac{\eta_{v,(i+1,j)}}{\Delta{x^2}}-2\frac{\eta_{v,(i,j)}}{\Delta{x^2}}.\end{equation}\]</p><p><em>East</em></p><p class="math-container">\[\begin{equation}\begin{gather*}
&amp; P_CP_{i,j} + P_SP_{i,j-1} + \\ &amp; Sv_{y,(i,j-1)} + SWv_{x,(i,j-1)} + SEv_{x,(i+1,j-1)} + Wv_{y,(i-1,j)} + \\ &amp; Cv_{y,(i,j)} + \\ &amp; NWv_{x,(i,j)} + NEv_{x,(i+1,j)} + Nv_{y,(i,j+1)} = \\ &amp; -\frac{\rho_{i,j}+\rho_{i+1,j}}{2} g_y -2\frac{\eta_{v,(i+1,j)}}{\Delta{x^2}}V_{BC,E}, 
\end{gather*}\end{equation}\]</p><p>where </p><p class="math-container">\[\begin{equation}C = -\frac{2}{\Delta{y^2}}\left(\eta_{c,(i,j)}+\eta_{c,(i,j-1)}\right)-\frac{2\eta_{v,(i+1,j)}}{\Delta{x^2}}-\frac{\eta_{v,(i,j)}}{\Delta{x^2}}.\end{equation}\]</p><p>Along the horizontal boundaries (<strong>North</strong>, <strong>South</strong>), <span>$C=1$</span> and the remaining coefficients and the right-hand side are equal to zero.</p><p>For more details on how this is implemented, please see the <a href="https://github.com/GeoSci-FFM/GeoModBox.jl/blob/main/src/MomentumEquation/2Dsolvers.jl">source code</a>.</p><hr/><hr/><h2 id="Continuum-Equation"><a class="docs-heading-anchor" href="#Continuum-Equation">Continuum Equation</a><a id="Continuum-Equation-1"></a><a class="docs-heading-anchor-permalink" href="#Continuum-Equation" title="Permalink"></a></h2><p>The continuum equation provides a third equation helping to solve for the third unknown <span>$P$</span>. </p><h3 id="Stencil-3"><a class="docs-heading-anchor" href="#Stencil-3">Stencil</a><a class="docs-heading-anchor-permalink" href="#Stencil-3" title="Permalink"></a></h3><p>The corresponding numerical stencil only includes the horizontal and vertical velocity (Fig. 4).</p><p><img src="../../assets/Stencil_continuum.png" alt="StencilContinuum"/></p><p><strong>Figure 4. Numerical stencil for the continuum equation.</strong> </p><p>Using the finite difference operators equations <span>$(3)$</span> is defined as: </p><p class="math-container">\[\begin{equation}
\frac{v_{x,(i+1,j)}-v_{x,(i,j)}}{\Delta{x}} + \frac{v_{y,(i,j+1)}-v_{y,(i,j)}}{\Delta{y}} = 0,
\end{equation}\]</p><p class="math-container">\[\begin{equation}
C_xv_{x,(i,j)} + E_xv_{x,(i+1,j)} + C_yv_{y,(i,j)} + N_yv_{y,(i,j+1)} = 0,
\end{equation}\]</p><p>where </p><p class="math-container">\[\begin{equation}
\begin{split}
-C_x = E_x = \frac{1}{\Delta{x}}, \\
-C_y = N_y = \frac{1}{\Delta{y}}.
\end{split}
\end{equation}\]</p><h2 id="Solution"><a class="docs-heading-anchor" href="#Solution">Solution</a><a id="Solution-1"></a><a class="docs-heading-anchor-permalink" href="#Solution" title="Permalink"></a></h2><p>To solve the linear system of equations, one needs to collect the coefficients for the coefficient matrix <span>$\bold{K}$</span> and set up the righ-hand side <span>$\overrightharpoon{rhs}$</span> (at least for the direct solution). </p><p>To set up the coefficient matrix <span>$\bold{K}$</span>, one needs to use a consecutive numbering for each unknown variable grid point (or <em>node</em>), corresponding to one equation. Here, we first number the equations of each corresponding central reference point <span>$(i,j)$</span> for the <em><span>$x$</span>-component</em> of the <em>momentum equation</em> (that is for the unknown <span>$v_x$</span>), followed by its <em><span>$y$</span>-component</em> (the unknown <span>$v_y$</span>), and at last the equations of the <em>conservation of mass</em> (for the unknown <span>$P$</span>). </p><p>The numbering for each equation is then defined as: </p><p><em><span>$x$</span>-compnent</em> (<span>$v_x$</span>) </p><p class="math-container">\[\begin{equation}
ii_x = 1\ \textrm{--}\ \left(nv_x \cdot nc_y\right),
\end{equation}\]</p><p><em><span>$y$</span>-component</em> (<span>$v_y$</span>)</p><p class="math-container">\[\begin{equation}
ii_y = \left(nv_x \cdot nc_y + 1 \right)\ \textrm{--}\ \left(nv_x \cdot nc_y + nc_x \cdot nv_y\right),
\end{equation}\]</p><p><em>conituum equation</em> (<span>$P$</span>)</p><p class="math-container">\[\begin{equation}
ii_p = \left(nv_x \cdot nc_y + nc_x \cdot nv_y + 1\right)\ \textrm{--}\ \left(nv_x \cdot nc_y + nc_x \cdot nv_y + nc_x \cdot nc_y\right),
\end{equation}\]</p><p>where <span>$nc_i$</span> and <span>$nv_i$</span> are the numbers of <em>centroids</em> and <em>vertices</em> in the <span>$i$</span>-th direction, respectively. </p><p>Each <em>line</em> <span>$(ii)$</span> of the coefficient matrix <span>$\bold{K}$</span> belongs to an equation. The coefficients <span>$K[ii_j,i_k]$</span> for the points of the unknown variables in the numerical stencils (Fig. 2-4) are located in the corresponding columns <span>$i_k$</span> of each line (relative to the central point <span>$\left[ii_j,i_c\right]$</span>). The numbering of the coefficients remains the same independent of the state of the viscosity, however, if the viscosity is variable additional coefficients for the <em>momentum equation</em> are added to the matrix: </p><p><em>Constant Viscosity</em></p><p><em><span>$x$</span>-component</em></p><p class="math-container">\[\begin{equation}\begin{split}
i_S &amp; = ii_x - nv_x, \\
i_W &amp; = ii_x - 1, \\
i_C &amp; = ii_x, \\
i_E &amp; = ii_x + 1, \\
i_N &amp; = ii_x + nv_x. 
\end{split}\end{equation}\]</p><p><em><span>$y$</span>-component</em></p><p class="math-container">\[\begin{equation}\begin{split}
i_S &amp; = ii_y - nc_x, \\
i_W &amp; = ii_y - 1, \\
i_C &amp; = ii_y, \\
i_E &amp; = ii_y + 1, \\
i_N &amp; = ii_y + nc_x. 
\end{split}\end{equation}\]</p><p><em>Variable Viscosity</em></p><p><em><span>$x$</span>-component</em></p><p class="math-container">\[\begin{equation}\begin{split}
i_S &amp; = ii_x - nv_x, \\
i_{SW} &amp; = ii_y - 1, \\
i_{SE} &amp; = ii_y, \\
i_W &amp; = ii_x - 1, \\
i_C &amp; = ii_x, \\
i_E &amp; = ii_x + 1, \\
i_{NW} &amp; = ii_y + nc_x, \\
i_{NE} &amp; = ii_y + nc_x + 1, \\
i_N &amp; = ii_x + nv_x. 
\end{split}\end{equation}\]</p><p><em><span>$y$</span>-component</em></p><p class="math-container">\[\begin{equation}\begin{split}
i_S &amp; = ii_y - nc_x, \\
i_{SW} &amp; = ii_x - nv_x, \\
i_{SE} &amp; = ii_x - nv_x + 1, \\
i_W &amp; = ii_y - 1, \\
i_C &amp; = ii_y, \\
i_E &amp; = ii_y + 1, \\
i_{NW} &amp; = ii_x, \\
i_{NE} &amp; = ii_x + 1, \\
i_N &amp; = ii_y + nc_x. 
\end{split}\end{equation}\]</p><p>The coefficients for the <em>conservation of mass</em> remain the same independent of the state of the viscosity. </p><p><em>continuum (P)</em></p><p class="math-container">\[\begin{equation}\begin{split}
i_S &amp; = ii_y, \\
i_W &amp; = ii_x, \\
i_C &amp; = ii_p, \\
i_E &amp; = ii_x + 1, \\
i_N &amp; = ii_y + nc_x. 
\end{split}\end{equation}\]</p><p>This results in a coefficient matrix <span>$\bold{K[ii_j,i_k]}$</span> in the form of: </p><p><img src="../../assets/CoefficientMatrix.png" alt="CoefficientMatrix"/></p><p><strong>Figure 5. Coefficient matrix, constant viscosity.</strong> Non-zero entries of a coefficient matrix for a resolution of <span>$nc_x=nc_y=10$</span> and a constant viscosity. Highlighted are the areas for the different equations: <span>$v_x$</span> - <em><span>$x$</span>-component</em> of the momentum equation, <span>$v_y$</span> - <em><span>$y$</span>-component</em> of the momentum equation, <span>$P$</span> - continuum equation. </p><p><img src="../../assets/CoefficientMatrixEtaVary.png" alt="CoefficientMatrix_vary"/></p><p><strong>Figure 6. Coefficient matrix, variable viscosity.</strong> Non-zero entries of a coefficient matrix for a resolution of <span>$nc_x=nc_y=10$</span> and a variable viscosity. Highlighted are the areas for the different equations: <span>$v_x$</span> - <em><span>$x$</span>-component</em> of the momentum equation, <span>$v_y$</span> - <em><span>$y$</span>-component</em> of the momentum equation, <span>$P$</span> - continuum equation. </p><p>The right-hand side vector <span>$\overrightharpoon{rhs}$</span> is given by the boundary and initial conditions (see equations <span>$(13)$</span> - <span>$(31)$</span> ). </p><h3 id="Direct"><a class="docs-heading-anchor" href="#Direct">Direct</a><a id="Direct-1"></a><a class="docs-heading-anchor-permalink" href="#Direct" title="Permalink"></a></h3><p>Using a direct solution method, one needs to do a right division of the coefficient matrix by the right-hand side to obtain the solution vector: </p><p class="math-container">\[\begin{equation}
\bold{K} \backslash \overrightharpoon{rhs} = \overrightharpoon{x}.
\end{equation}\]</p><h3 id="Defect-Correction"><a class="docs-heading-anchor" href="#Defect-Correction">Defect Correction</a><a id="Defect-Correction-1"></a><a class="docs-heading-anchor-permalink" href="#Defect-Correction" title="Permalink"></a></h3><p>The defect correction method is very helpful, in case the system is non-linear. First, one needs to calculate the residual for each equation, where the unknowns are given by an initial guess (usually all equal to zero): </p><p><em>Residual calculation</em> </p><p class="math-container">\[\begin{equation}\begin{split}
R_x &amp; = \frac{\partial{\tau_{xx}}}{\partial{x}} + \frac{\partial{\tau_{xy}}}{\partial{y}} - \frac{\partial{P}}{\partial{x}}, \\
R_y &amp; = \frac{\partial{\tau_{yy}}}{\partial{y}} + \frac{\partial{\tau_{yx}}}{\partial{x}} - \frac{\partial{P}}{\partial{y}} + \rho g_y, \\
R_p &amp; = \frac{\partial{v_x}}{\partial{x}} + \frac{\partial{v_y}}{\partial{y}},
\end{split}\end{equation}\]</p><p>and in form of the finite difference operators: </p><p class="math-container">\[\begin{equation}\begin{split}
R_x &amp; = \frac{\tau_{xx,(i,j)}-\tau_{xx,(i-1,j)}}{\Delta{x}} + \frac{\tau_{xy,(i,j+1)}-\tau_{xy,(i,j)}}{\Delta{y}} - \frac{P_{i,j}-P_{i-1,j}}{\Delta{x}}, \\
R_y &amp; = \frac{\tau_{yy,(i,j)}-\tau_{yy,(i,j-1)}}{\Delta{y}} + \frac{\tau_{yx,(i+1,j)}-\tau_{yx,(i,j)}}{\Delta{x}} - \frac{P_{i,j}-P_{i,j-1}}{\Delta{y}} + \frac{\rho_{i,j}+\rho_{i+1,j}}{2} g_y, \\
R_p &amp; = \frac{v_{x,(i+1,j)}-v_{x,(i,j)}}{\Delta{x}} + \frac{v_{y,(i,j+1)}-v_{y,(i,j)}}{\Delta{y}}.
\end{split}\end{equation}\]</p><p>If the velocities do not lie directly on the boundaries, they can be calculated via equations <span>$(16)$</span> - <span>$(19)$</span> for <em>free slip</em> and via equations <span>$(29)$</span> - <span>$(32)$</span> for <em>no slip</em> boundary condtions. The stresses are either calculated via the viscosity at the <em>vertices</em> or the <em>centroids</em>. Similar to the direct method, the residuals <span>$R_x, R_y, \textrm{ and }, R_p$</span> are stored in a vector <span>$R$</span> with the numbering of each equation as shown in equations <span>$(75)$</span> - <span>$(79)$</span>. The coefficient matrix <span>$\bold{K}$</span> is the same as described before. For more details on the defect correction method for the stokes equation see the <a href="../MomentumOneD/">1-D documentation</a>.</p><p>The correction term is calculated via the residual and the coefficient matrix as: </p><p class="math-container">\[\begin{equation}
\delta=- \bold{K} \backslash R.
\end{equation}\]</p><p class="math-container">\[\delta\]</p><p>is a vector with the dimensions <span>$\left(nv_x \cdot nc_y + nc_x \cdot nv_y + nc_x \cdot nc_y\right)$</span>, that is for the total number of equations of all unknowns <span>$\left(v_x, v_y, P\right)$</span>. Finally one needs to update the inital guess by the correction term: </p><p class="math-container">\[\begin{equation}\begin{split}
v_x &amp; = v_{x,i} + \delta{v_x}, \\
v_y &amp; = v_{y,i} + \delta{v_y}, \\
P &amp; = P_{i} + \delta{P},
\end{split}\end{equation}\]</p><p>where the indices of the vector <span>$\delta$</span> correspond to the indices of the unknowns <span>$\left(v_x, v_y, P\right)$</span> as shown in equations <span>$(72)$</span> - <span>$(74)$</span>.</p><p><strong>Note:</strong> To updated the array of the unknowns <span>$v_x, v_y, P$</span>, one need to assign the elements of the one-dimensional vector <span>$\delta$</span> to the two-dimensional array following the numbering shown in equations <span>$(72)$</span> -<span>$(74)$</span>.</p><p>For more information on how both methods are implemented see the <a href="https://github.com/GeoSci-FFM/GeoModBox.jl/blob/main/examples/StokesEquation/2D/">examples</a>.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../MomentumOneD/">« 1D</a><a class="docs-footer-nextpage" href="../listoffunctions/">List of functions »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.10.1 on <span class="colophon-date" title="Thursday 17 April 2025 14:48">Thursday 17 April 2025</span>. Using Julia version 1.11.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
